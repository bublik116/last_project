# Журнал изменений — Signal Sum (аудио)

Дата: 2025-09-16

## Новое: минимально жизнеспособная версия (MVP)
- Созданы файлы проекта:
  - `index.html` — структура страницы, элементы управления, секции визуализации.
  - `styles.css` — оформление в тёмной теме.
  - `app.js` — ядро генерации, сумма сигналов, воспроизведение и визуализация.
- Возможности MVP:
  - До 10 источников с параметрами: тип, амплитуда (пиковая), частота, фаза, дополнительный параметр (duty/τ/f1), смещение, вкл/выкл.
  - Поддерживаемые типы: синус, квадрат (меандр), треугольник, пила вверх, пила вниз, импульсы (uni), DC, белый шум, затухающая синусоида, chirp.
  - Глобальные настройки: частота дискретизации (44.1/48 кГц), длительность окна наблюдения, нормализация уровня.
  - Визуализация во временной области на Canvas.
  - Воспроизведение через WebAudio API.
  - Экспорт WAV (PCM 16-bit) и CSV (t,y).
  - Предупреждения: критерий Найквиста/алиасинг, клиппинг.

## Улучшение UX: бегунки частоты и масштабирование окна
- Для каждого источника добавлен слайдер частоты (20…20000 Гц), синхронизированный с числовым полем.
- Для источников `DC` и `Белый шум` частотный ввод и слайдер отключены (не применимо).
- Добавлены элементы управления окном просмотра:
  - Масштаб и смещение окна (в миллисекундах) — ползунки + числовые поля.
  - Кнопка «Весь сигнал».
  - Поддержка мыши: колесо — зум относительно курсора; перетаскивание — панорама (сдвиг окна).
- График времени теперь рисуется по выбранному фрагменту.

## Спектральный анализ: вкладка «Спектр (FFT)» и пики
- Введена панель вкладок: «Время» и «Спектр (FFT)».
- Раздел «Спектр (FFT)» включает:
  - Выбор размера FFT: 2048 / 4096 / 8192 / 16384.
  - Оконные функции: Rect, Hann, Hamming.
  - Логарифмическая шкала амплитуды (дБ) — по умолчанию включена.
  - Количество выделяемых пиков (до 20) и кнопка «Пересчитать спектр».
  - Холст `fftCanvas` для спектра и панель статуса с Δf.
- Реализовано:
  - Radix-2 FFT (in-place) с оконным взвешиванием и односторонним спектром (0…Fs/2).
  - Отрисовка спектра в линейной или дБ-шкале, маркировка пиков с подписями частоты.
  - Автоматический пересчёт FFT при изменении сигнала, если активна вкладка «Спектр».

## Стайлинг и мелкие доработки
- Стилизация слайдеров `input[type=range]` под тему (трек и бегунок).
- Стили вкладок, состояние активной вкладки, класс `.hidden` для секций.
- Подпись информационной строки «N, Δf, пики» для спектра.

## Замечания по амплитудам и окнам
- При применении окон (Hann/Hamming) амплитуды пиков ниже из-за оконного взвешивания. При необходимости можно добавить поправку на «coherent gain», чтобы амплитуда синусуиды соответствовала исходной.

## Идеи для следующих шагов
- Логарифмическая ось частоты (x) и курсор значений (f, A/дБ) под мышью.
- THD/THD+N и автоматическое выделение гармоник от выбранной основной частоты.
- Экспорт спектра (CSV/PNG) и пресеты сигналов (ряды Фурье, AM/FM и т.п.).
- Адаптивный размер канвасов и быстрый «подгон по периоду» (двойной клик).

---

Дата: 2025-09-17

## Новое: вкладка «Речь (форманты)»
- Интерфейс:
  - Вкладка «Речь (форманты)» с холстом `speechCanvas` и панелью параметров.
  - Пресеты гласных (А, Э, И, О, У) и выбор голоса (мужской/женский). Для женского — масштабирование формант ~×1.2.
  - Настройки: F0 (ползунок+число), длительность, уровни voiced/noise, F1–F3 и полосы B1–B3 (Гц).
  - Кнопки: «Синтезировать», «Проиграть», «Экспорт WAV».
- Реализация:
  - Источник-фильтр: импульсный поезд на частоте F0 (голосовая составляющая) + белый шум (шумовая составляющая).
  - Три параллельных полосовых би-квадратных фильтра (RBJ) на частотах F1–F3 с полосами B1–B3 (приближение формант).
  - Суммирование выходов резонаторов, нормализация по пику, отрисовка формы на `speechCanvas`.
  - Прослушивание через WebAudio и экспорт WAV (16-bit PCM).
- Примечания:
  - Текущая модель статична по времени (устойчивый гласный). В следующих версиях добавим траектории формант и плавные переходы.

## Идеи для следующего шага по речи
- Источник возбуждения с реалистичной глоттальной формой (Rosenberg/LF) вместо импульсного поезда.
- Динамика формант (анимация F1–F3/B1–B3 во времени), коартикуляция, дифтонги.
- Сибилянты/фрикативы: полосовой шум (s, sh, f), аспирация.
- Предыскажение/предэмфаза, управление тембром, vibrato/jitter/shimmer.
